package util_test

import (
	"testing"

	"github.com/SUSE/cf-plugin-backup/util"
)

func TestCheckUserScope_HasScope(t *testing.T) {
	token := "eyJhbGciOiJSUzI1NiIsImtpZCI6ImxlZ2FjeS10b2tlbi1rZXkiLCJ0eXAiOiJKV1QifQ.eyJqdGkiOiI5MWJkZWQ2NTU1ZDI0OTlhYmQwZmFhOWI0ODFlYTA1YiIsInN1YiI6IjFhYWU5NjNhLTFmMTgtNDIwOC04ZDcyLWEzMjI4NjkxYzYzZSIsInNjb3BlIjpbInJvdXRpbmcucm91dGVyX2dyb3Vwcy5yZWFkIiwiY2xvdWRfY29udHJvbGxlci5yZWFkIiwicGFzc3dvcmQud3JpdGUiLCJjbG91ZF9jb250cm9sbGVyLndyaXRlIiwib3BlbmlkIiwiZG9wcGxlci5maXJlaG9zZSIsInNjaW0ud3JpdGUiLCJzY2ltLnJlYWQiLCJjbG91ZF9jb250cm9sbGVyLmFkbWluIiwidWFhLnVzZXIiXSwiY2xpZW50X2lkIjoiY2YiLCJjaWQiOiJjZiIsImF6cCI6ImNmIiwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6IjFhYWU5NjNhLTFmMTgtNDIwOC04ZDcyLWEzMjI4NjkxYzYzZSIsIm9yaWdpbiI6InVhYSIsInVzZXJfbmFtZSI6ImFkbWluIiwiZW1haWwiOiJhZG1pbiIsInJldl9zaWciOiIzODQ1Y2IxNCIsImlhdCI6MTQ4Mzk2NTQ1MSwiZXhwIjoxNDgzOTY2MDUxLCJpc3MiOiJodHRwczovL2hjZi51YWEuZXhhbXBsZS5jb20vb2F1dGgvdG9rZW4iLCJ6aWQiOiJoY2YiLCJhdWQiOlsic2NpbSIsImNsb3VkX2NvbnRyb2xsZXIiLCJwYXNzd29yZCIsImNmIiwidWFhIiwib3BlbmlkIiwiZG9wcGxlciIsInJvdXRpbmcucm91dGVyX2dyb3VwcyJdfQ.ZjX_Wr450SM6jigEBEQDs72_wJDQv2EPRYNG-ucPCFMDjvlwYZrUjaMeJkuVanwXFZhKR2oDflUZQeg78Ue49IPD9G7DiBSUbbgLsQkSRLmy3HJ8vipO8p8uZOmFdDsGbyJ8zFu0wkYTGTwQUfxxYq7j4egn3eZHcXc0rScaKbxlW-X2XLP04uUCc6O9EWxzWOzyE-q27lfGstkosEy1rWMOKs-6xpTimczYT0mnoqr3f6wjUtoYFHrrlPvQ6BPhE5Pm3lItw8BzRO3hUEMxGbgpfhdQ3dy0uBcRwR9Bc6WPpNkGjE8ENORYX82LvVb62IOTyRMphP60MCbvE7TQA98puN6aWmZZfJVmZ7VlBkl_1v8jjrUeWoyCv_0gilbQYsV1dfkll325_Lpp4eXHnsEXZUAgwMgxji4nhvjgk4YR9m9COdPGUzaSRQNm7NS04tHQY65YK8DwEi1SAljHWaghTHYkq5foShRQPLh2TS2QAjJRxH49eRla8DKVh4Cw_1FNy9lH_26xmRbPkf6L6GL_oG5r99emHAihcu8lE7cx7D129Z5JoGJ7RUNB3zA_89YwQPrnUSChoZ2KVU0qioZbH5f5YY4tjwCy-EG8i5DrNK94ti9gf-kVL5qoyMkC02r2EqHxXsQa2xuO_tGobJEqDJ0-3G00DPI2-MFb-_k"
	hasScope, err := util.CheckUserScope(token, "cloud_controller.admin")

	if err != nil {
		t.Fatal(err.Error())
	}

	if !hasScope {
		t.Fatal("scope not present")
	}
}

func TestCheckUserScope_NoScope(t *testing.T) {
	token := "eyJhbGciOiJSUzI1NiIsImtpZCI6ImxlZ2FjeS10b2tlbi1rZXkiLCJ0eXAiOiJKV1QifQ.eyJqdGkiOiIzMWJhMzM4NGQzOGU0NzZiODYyNjZmMmY5N2RmNmI2YyIsInN1YiI6ImQyN2UxZDU0LWQ2YzAtNGRhZi04N2NlLWQ5ZTc5NDhkZmM3MyIsInNjb3BlIjpbInJvdXRpbmcucm91dGVyX2dyb3Vwcy5yZWFkIiwiY2xvdWRfY29udHJvbGxlci5yZWFkIiwicGFzc3dvcmQud3JpdGUiLCJjbG91ZF9jb250cm9sbGVyLndyaXRlIiwib3BlbmlkIiwiZG9wcGxlci5maXJlaG9zZSIsInNjaW0ud3JpdGUiLCJzY2ltLnJlYWQiLCJjbG91ZF9jb250cm9sbGVyLmFkbWluIiwidWFhLnVzZXIiXSwiY2xpZW50X2lkIjoiY2YiLCJjaWQiOiJjZiIsImF6cCI6ImNmIiwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6ImQyN2UxZDU0LWQ2YzAtNGRhZi04N2NlLWQ5ZTc5NDhkZmM3MyIsIm9yaWdpbiI6InVhYSIsInVzZXJfbmFtZSI6ImFkbWluIiwiZW1haWwiOiJhZG1pbiIsInJldl9zaWciOiI5MTlhNTNiNiIsImlhdCI6MTQ4MjE1NDE1MiwiZXhwIjoxNDgyMTU0NzUyLCJpc3MiOiJodHRwOi8vaGNmLmxvY2FsaG9zdDo4MDgwL3VhYS9vYXV0aC90b2tlbiIsInppZCI6ImhjZiIsImF1ZCI6WyJzY2ltIiwiY2xvdWRfY29udHJvbGxlciIsInBhc3N3b3JkIiwiY2YiLCJ1YWEiLCJvcGVuaWQiLCJkb3BwbGVyIiwicm91dGluZy5yb3V0ZXJfZ3JvdXBzIl19.ihgWURw0coxSOsiRWG-c_CWZpY9ykk5RB4dCDvGpHpx2d3Uid9dIKb-K9zOgkolGpKnu3_92oAYDYbVpqtJWmmVYBYXA0aZinUlV-8Xg6AnhWfB-NwrSvxqKXECzA6rZr6Uf6Wvg0UwgwjuFZfXpxQ6bsfntzhATOkbCcRuWfHGIq65Z8emj9pk4yNfn9AXBSf0I8MGmQCSQlDMgIywxGrvPwcfMlHRkXw65aN1o3vjCWA9Wabqy3RuoxXgL15yA1jp2Bp7EbPF4VL0bLUZBv1vt8rSA0S0ckPlUJhjCvZwdlHxgzvEuErrY1PuU63xiqQXEuJsU7etEtoN1uBOQVQ"

	hasScope, err := util.CheckUserScope(token, "inexistent_scope")

	if err != nil {
		t.Fatal(err.Error())
	}

	if hasScope {
		t.Fatal("scope should not be present")
	}
}
